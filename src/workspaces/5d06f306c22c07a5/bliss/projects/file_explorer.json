{
  "name": "File explorer",
  "compiler": "react",
  "version": "v0.2",
  "type": "app",
  "build": "designer",
  "nextId": 7,
  "rootId": "1",
  "externalCss": [],
  "externalJs": [
    "node_modules/react/dist/react.js",
    "node_modules/react-dom/dist/react-dom.js",
    "node_modules/jquery/dist/jquery.min.js",
    "components/bliss-utils/js/state.js"
  ],
  "state": {},
  "packages": [
    {
      "name": "react",
      "version": "15.4.2"
    },
    {
      "name": "react-dom",
      "version": "15.4.2"
    },
    {
      "name": "jquery",
      "version": "^3.2.1"
    }
  ],
  "js": [
    {
      "name": "init",
      "body": "function() {\n  app.dispatch({\n    path: '/file_explorer',\n    action: 'getEntries'\n  });\n}"
    }
  ],
  "cssVars": [],
  "css": [],
  "load": [
    "init"
  ],
  "components": {
    "1": {
      "id": "1",
      "name": "File Explorer",
      "element": "div",
      "text": null,
      "attributes": [],
      "css": [
        {
          "selector": "$id",
          "properties": []
        }
      ],
      "js": [],
      "dynamicAttributes": [],
      "next": null,
      "previous": null,
      "child": "4",
      "parent": null
    },
    "2": {
      "id": "2",
      "name": "file",
      "element": "div",
      "text": null,
      "textFn": "getText",
      "ifFn": null,
      "repeatFn": "repeater",
      "attributes": [],
      "css": [
        {
          "selector": "$id",
          "properties": [
            {
              "name": "padding",
              "value": "5px 10px"
            },
            {
              "name": "cursor",
              "value": "pointer"
            },
            {
              "name": "background-color",
              "value": "#f3f3f3"
            },
            {
              "name": "margin-bottom",
              "value": "5px"
            },
            {
              "name": "font-size",
              "value": "14px"
            }
          ]
        }
      ],
      "js": [
        {
          "name": "repeater",
          "body": "function(scope, attributes) {\n  return app.state.file_explorer.entries;\n};\n"
        },
        {
          "name": "getText",
          "body": "function(scope, attributes) {\n  return scope.repeater[scope.repeater_index];\n};\n"
        },
        {
          "name": "handleClick",
          "body": "function(scope, attributes) {\n  var selected = scope.repeater[scope.repeater_index];\n  var cwd = app.state.file_explorer.cwd;\n  \n  if(selected === '..') {\n    var cwdParts = cwd.split('/');\n    if(cwdParts.length > 1) {\n      cwd = '';\n      for(var i=0; i<cwdParts.length - 1; i++) {\n        cwd += cwdParts[i];\n        if(i < cwdParts.length - 2) cwd += '/';\n      }\n    } else {\n      cwd = '.';\n    }\n  } else {\n    cwd = cwd + '/' + selected;\n  }\n  \n  return function(e) {\n    app.dispatch({\n      path: '/file_explorer',\n      action: 'setCwd',\n      cwd: cwd\n    });\n    \n    app.dispatch({\n      path: '/file_explorer',\n      action: 'getEntries'\n    });\n  }\n};\n"
        }
      ],
      "dynamicAttributes": [
        {
          "name": "onClick",
          "value": "handleClick"
        }
      ],
      "next": null,
      "previous": "6",
      "child": null,
      "parent": "4"
    },
    "4": {
      "id": "4",
      "name": "file container",
      "element": "div",
      "text": null,
      "textFn": null,
      "ifFn": null,
      "repeatFn": null,
      "attributes": [],
      "css": [
        {
          "selector": "$id",
          "properties": [
            {
              "name": "border",
              "value": "solid 5px #ccc"
            },
            {
              "name": "padding",
              "value": "5px 5px 0px 5px"
            },
            {
              "name": "border-radius",
              "value": "5px"
            }
          ]
        }
      ],
      "js": [],
      "dynamicAttributes": [],
      "next": null,
      "previous": null,
      "child": "5",
      "parent": "1"
    },
    "5": {
      "id": "5",
      "name": "selected file",
      "element": "div",
      "text": "",
      "textFn": "getText",
      "ifFn": null,
      "repeatFn": "",
      "attributes": [],
      "css": [
        {
          "selector": "$id",
          "properties": [
            {
              "name": "padding",
              "value": "5px 10px"
            },
            {
              "name": "cursor",
              "value": "pointer"
            },
            {
              "name": "background-color",
              "value": "#a9cef3"
            },
            {
              "name": "margin-bottom",
              "value": "5px"
            },
            {
              "name": "font-size",
              "value": "16px"
            }
          ]
        }
      ],
      "js": [
        {
          "name": "getText",
          "body": "function(scope, attributes) {\n  return app.state.file_explorer.cwd;\n};\n"
        }
      ],
      "dynamicAttributes": [],
      "next": "6",
      "previous": null,
      "child": null,
      "parent": "4"
    },
    "6": {
      "id": "6",
      "name": "separator",
      "element": "div",
      "text": null,
      "textFn": null,
      "ifFn": null,
      "repeatFn": null,
      "attributes": [],
      "css": [
        {
          "selector": "$id",
          "properties": [
            {
              "name": "height",
              "value": "5px"
            },
            {
              "name": "background-color",
              "value": "#ccc"
            },
            {
              "name": "margin-bottom",
              "value": "5px"
            }
          ]
        }
      ],
      "js": [],
      "dynamicAttributes": [],
      "next": "2",
      "previous": "5",
      "child": null,
      "parent": "4"
    }
  },
  "schemas": [
    {
      "path": "/file_explorer",
      "actions": [
        {
          "action": "init",
          "body": "function (data, args) {\n  $.ajaxSetup({headers:{'X-User-Token':'development'}});\n  \n  var newData = {\n    cwd: '.',\n    entries: []\n  };\n  \n  return newData;\n}"
        },
        {
          "action": "setEntries",
          "body": "function (data, args) {\n  console.log('setEntries', app.state.file_explorer.entries);\n  var newData = Object.assign({}, data);\n  \n  // empty array\n  newData.entries.splice(0, newData.entries.length);\n  \n  newData.entries.push('..');\n  \n  // add new entries\n  args.entries.forEach(function(entry) {\n    newData.entries.push(entry);\n  });\n  \n  return newData;\n}"
        },
        {
          "action": "setCwd",
          "body": "function (data, args) {\n  var newData = Object.assign({}, data)\n  newData.cwd = args.cwd;\n  return newData;\n}"
        },
        {
          "action": "getEntries",
          "body": "function (data, args) {\n  var path = app.state.file_explorer.cwd;\n  var workspace = 'bliss';\n  \n  var url = '/workspace/file_explorer?';\n  url += 'workspace=' + workspace;\n  url += '&path=' + path;\n  \n  $.ajax({\n    type: 'GET',\n    url: url,\n    data: {},\n    success: function(data) {\n      app.dispatch({\n        path: '/file_explorer',\n        action: 'setEntries',\n        entries: data\n      });\n    },\n    contentType: \"application/json\",\n    dataType: 'json'\n  });\n  \n  console.log('getEntries', app.state.file_explorer.cwd);\n  \n  return data;\n}"
        }
      ]
    }
  ]
}